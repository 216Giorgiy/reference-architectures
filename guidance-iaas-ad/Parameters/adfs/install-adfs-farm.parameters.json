{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "virtualMachinesExtensionSettings": {
      "value": [
        {
          "vms": [ "ra-ad-adfs-vm0" ],
          "extensions": [
            {
              "name": "install-adfs",
              "publisher": "Microsoft.Compute",
              "type": "CustomScriptExtension",
              "typeHandlerVersion": "1.8",
              "autoUpgradeMinorVersion": false,
              "settingsConfigMapperUri": "https://raw.githubusercontent.com/mspnp/template-building-blocks/master/templates/resources/Microsoft.Compute/virtualMachines/extensions/vm-extension-passthrough-settings-mapper.json",
              "settingsConfig": {
                "fileUris": [
                  "https://raw.githubusercontent.com/mspnp/reference-architectures/andrew/ra-ad/guidance-iaas-ad/extensions/Import-ADFSCertificate.ps1",
                  "https://raw.githubusercontent.com/mspnp/reference-architectures/andrew/ra-ad/guidance-iaas-ad/extensions/Configure-AdfsServer.ps1"
                ],
                "commandToExecute": "powershell -ExecutionPolicy Unrestricted -Command \"& {.\\Import-ADFSCertificate.ps1 -Base64EncodedCertificate \\\"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\\\" -CertificatePassword \\\"AweS0meC3rt@PW\\\" -CertificateType Pfx;.\\Configure-AdfsServer.ps1 -AdminUser \\\"testuser\\\" -AdminPassword \\\"AweS0me@PW\\\" -NetBiosDomainName \\\"CONTOSO\\\" -FqDomainName \\\"contoso.com\\\" -GmsaName \\\"adfsgmsa\\\" -FederationName \\\"adfs.contoso.com\\\" -Description \\\"Contoso Corporation\\\"}\""
              },
              "protectedSettingsConfig": {
              }
            }
          ]
        }
      ]
    }
  }
}
